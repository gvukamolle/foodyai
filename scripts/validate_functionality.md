# Функциональная валидация Clean Architecture рефакторинга

## Обзор
Этот документ содержит чек-лист для валидации того, что все существующие функции приложения работают корректно после рефакторинга на Clean Architecture.

## Основные функции для проверки

### 1. Управление профилем пользователя ✅
- [ ] Создание нового профиля пользователя
- [ ] Редактирование существующего профиля
- [ ] Сохранение изменений профиля
- [ ] Расчет BMI на основе роста и веса
- [ ] Расчет целевых значений питания
- [ ] Валидация данных пользователя

**Тестовые сценарии:**
```kotlin\n// Создание пользователя\nval user = User(\n    name = \"Тест Пользователь\",\n    birthday = \"1990-01-01\",\n    height = 180,\n    weight = 75,\n    gender = Gender.MALE,\n    activityLevel = ActivityLevel.MODERATELY_ACTIVE,\n    goal = NutritionGoal.MAINTAIN_WEIGHT\n)\n\n// Проверка расчета BMI\nval bmi = user.getBMI() // Должно быть ~23.15\n\n// Проверка расчета целевых значений\nval targets = calculateNutritionTargetsUseCase(user)\n// Должно вернуть разумные значения калорий, белков, жиров, углеводов\n```\n\n### 2. Анализ еды ✅\n- [ ] Анализ еды по фотографии\n- [ ] Анализ еды по текстовому описанию\n- [ ] Валидация результатов AI анализа\n- [ ] Обработка ошибок анализа\n\n**Тестовые сценарии:**\n```kotlin\n// Анализ по фото\nval photoResult = analyzeFoodPhotoUseCase(\n    AnalyzeFoodPhotoUseCase.Params(\"/path/to/photo.jpg\", \"яблоко\")\n)\n\n// Анализ по описанию\nval textResult = analyzeFoodDescriptionUseCase(\n    AnalyzeFoodDescriptionUseCase.Params(\"одно среднее яблоко\")\n)\n\n// Проверка валидности результата\nval food = photoResult.data\nassertTrue(food.hasReasonableNutrition())\n```\n\n### 3. Сохранение приемов пищи ✅\n- [ ] Сохранение еды в завтрак\n- [ ] Сохранение еды в обед\n- [ ] Сохранение еды в ужин\n- [ ] Сохранение еды в перекус\n- [ ] Валидация данных еды перед сохранением\n- [ ] Обновление дневной статистики\n\n**Тестовые сценарии:**\n```kotlin\n// Сохранение еды\nval food = Food(\n    name = \"Яблоко\",\n    calories = 95,\n    protein = 0.5,\n    fat = 0.3,\n    carbs = 25.0,\n    weight = \"100г\",\n    source = FoodSource.MANUAL_INPUT\n)\n\nval result = saveFoodIntakeUseCase(\n    SaveFoodIntakeUseCase.Params(food, MealType.BREAKFAST, LocalDate.now())\n)\n\nassertTrue(result is Result.Success)\n```\n\n### 4. Отслеживание питания ✅\n- [ ] Получение дневной статистики питания\n- [ ] Получение недельной статистики\n- [ ] Получение месячной статистики\n- [ ] Расчет прогресса к целям\n- [ ] Отображение трендов питания\n\n**Тестовые сценарии:**\n```kotlin\n// Получение дневной статистики\nval dailyIntake = getDailyIntakeUseCase(\n    GetDailyIntakeUseCase.Params(LocalDate.now())\n)\n\n// Расчет прогресса\nval progress = calculateNutritionProgressUseCase(\n    CalculateNutritionProgressUseCase.Params(\n        dailyIntake.data,\n        targetCalories = 2000,\n        targetProteins = 150.0,\n        targetFats = 67.0,\n        targetCarbs = 250.0\n    )\n)\n```\n\n### 5. История еды ✅\n- [ ] Получение истории недавно добавленной еды\n- [ ] Фильтрация истории по типу источника\n- [ ] Повторное использование еды из истории\n\n**Тестовые сценарии:**\n```kotlin\n// Получение истории\nval history = getFoodHistoryUseCase(\n    GetFoodHistoryUseCase.Params(limit = 10)\n)\n\nassertTrue(history.data.isNotEmpty())\n```\n\n### 6. Валидация данных ✅\n- [ ] Валидация пользовательских данных\n- [ ] Валидация данных еды\n- [ ] Валидация лимитов использования AI\n- [ ] Обработка ошибок валидации\n\n**Тестовые сценарии:**\n```kotlin\n// Валидация пользователя\nval invalidUser = User(name = \"\") // Пустое имя\nval validationResult = validateUserDataUseCase(\n    ValidateUserDataUseCase.Params(invalidUser)\n)\n\nassertTrue(validationResult is Result.Error)\nassertTrue(validationResult.exception is DomainException.ValidationException)\n```\n\n## Проверка архитектурных принципов\n\n### 1. Разделение слоев ✅\n- [ ] Domain слой не зависит от внешних фреймворков\n- [ ] Data слой реализует интерфейсы из Domain слоя\n- [ ] Presentation слой использует только Use Cases\n- [ ] Зависимости направлены внутрь (к Domain слою)\n\n### 2. Обработка ошибок ✅\n- [ ] Все ошибки обернуты в Result<T>\n- [ ] Domain исключения используются для бизнес-логики\n- [ ] Ошибки правильно пробрасываются через слои\n- [ ] UI получает понятные сообщения об ошибках\n\n### 3. Тестируемость ✅\n- [ ] Use Cases можно тестировать изолированно\n- [ ] Repository implementations можно мокать\n- [ ] ViewModels тестируются с мокированными Use Cases\n- [ ] Domain entities имеют unit тесты\n\n## Производительность\n\n### 1. Время запуска ✅\n- [ ] Приложение запускается не медленнее чем раньше\n- [ ] Dependency injection не замедляет инициализацию\n- [ ] Lazy loading работает корректно\n\n### 2. Использование памяти ✅\n- [ ] Нет утечек памяти в новой архитектуре\n- [ ] ViewModels правильно очищают ресурсы\n- [ ] Repository кэширование работает эффективно\n\n### 3. Отзывчивость UI ✅\n- [ ] UI остается отзывчивым во время операций\n- [ ] Корутины используются правильно\n- [ ] Блокирующие операции выполняются в фоне\n\n## Интеграционные тесты\n\n### 1. End-to-End сценарии ✅\n- [ ] Полный цикл: анализ фото → сохранение → отображение статистики\n- [ ] Создание профиля → расчет целей → отслеживание прогресса\n- [ ] Обработка ошибок на всех уровнях\n\n### 2. Совместимость данных ✅\n- [ ] Существующие данные корректно мигрируют\n- [ ] Mappers правильно преобразуют данные\n- [ ] Обратная совместимость сохранена\n\n## Команды для запуска тестов\n\n```bash\n# Запуск всех unit тестов\n./gradlew test\n\n# Запуск только domain тестов\n./gradlew testDebugUnitTest --tests \"*domain*\"\n\n# Запуск только data тестов\n./gradlew testDebugUnitTest --tests \"*data*\"\n\n# Запуск только presentation тестов\n./gradlew testDebugUnitTest --tests \"*presentation*\"\n\n# Запуск интеграционных тестов\n./gradlew testDebugUnitTest --tests \"*integration*\"\n\n# Генерация отчета о покрытии кода\n./gradlew jacocoTestReport\n```\n\n## Критерии успеха\n\n✅ **Все существующие функции работают корректно**\n✅ **Новая архитектура соблюдает принципы Clean Architecture**\n✅ **Тесты покрывают все критические пути**\n✅ **Производительность не ухудшилась**\n✅ **Код стал более поддерживаемым и тестируемым**\n\n## Заключение\n\nПосле выполнения всех проверок из этого чек-листа можно считать, что рефакторинг на Clean Architecture выполнен успешно и все функции приложения сохранены.\n